(function(){var PubSub,__hasProp={}.hasOwnProperty,__slice=[].slice;PubSub=function(){function PubSub(){}PubSub.prototype.subscribe=function(event,callback,context){var callb,_base;if(!(event!=null)){throw new Error("No event defined")}if(typeof callback!=="function"){throw new Error("No callback defined")}this._pubsub||(this._pubsub={});callb={callback:callback,context:context||this};(_base=this._pubsub)[event]||(_base[event]=[]);this._pubsub[event].push(callb);return this};PubSub.prototype.unsubscribe=function(event,callback,context){var callb,callbacks,cntxt,i,key,val,_i,_ref,_ref1;if(!this._pubsub){return this}if(!(event!=null)){if(!(callback!=null)&&!(context!=null)){delete this._pubsub;return this}else{_ref=this._pubsub;for(key in _ref){if(!__hasProp.call(_ref,key))continue;val=_ref[key];if(key!=null){this.unsubscribe(key,callback,context)}}return this}}else if(!(callback!=null)&&!(context!=null)){delete this._pubsub[event];return this}callbacks=this._pubsub[event]||[];for(i=_i=_ref1=callbacks.length-1;_ref1<=-1?_i<-1:_i>-1;i=_ref1<=-1?++_i:--_i){callb=callbacks[i].callback;cntxt=callbacks[i].context;callb=callb._original||callb;if(callback!=null&&context!=null&&cntxt===context&&callb===callback||!(context!=null)&&callb===callback||!(callback!=null)&&cntxt===context){callbacks.splice(i,1)}}return this};PubSub.prototype.publish=function(){var args,callb,callback,callbacks,event,i,_i,_ref;event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];if(!(event!=null)){throw new Error("No event defined")}if(!this._pubsub){return this}callbacks=this._pubsub[event]||[];for(i=_i=_ref=callbacks.length-1;_ref<=-1?_i<-1:_i>-1;i=_ref<=-1?++_i:--_i){callb=callbacks[i];callback=callb.callback;callback.apply(callb.context,args)}return this};PubSub.prototype.once=function(event,callback,context){var wrapped;if(!(event!=null)){throw new Error("No event defined")}if(typeof callback!=="function"){throw new Error("No callback defined")}wrapped=function(){delete wrapped._original;this.unsubscribe(event,wrapped);return callback.apply(context,arguments)};wrapped._original=callback;return this.subscribe(event,wrapped)};PubSub.prototype.on=PubSub.prototype.subscribe;PubSub.prototype.off=PubSub.prototype.unsubscribe;PubSub.prototype.trigger=PubSub.prototype.publish;return PubSub}();if(typeof define==="function"&&typeof define.amd==="object"&&define.amd){define(function(){return PubSub})}else if(typeof module==="object"&&module&&module.exports){module.exports=PubSub}else{this.PubSub=PubSub}}).call(this);